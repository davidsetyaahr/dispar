<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
        integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/assets/owl.carousel.min.css"
        integrity="sha512-tS3S5qG0BlhnQROyJXvNjeEM4UpMXHrQfTGmbQ1gKmelCxlSEBUaxhRBj/EFTzpbP4RVSrpEikbmdJobCvhE3g=="
        crossorigin="anonymous" />
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/assets/owl.theme.default.min.css"
        integrity="sha512-sMXtMNL1zRzolHYKEujM2AqCLUR9F2C4/05cdbxjjLSRvMQIciEPCQZo++nk7go3BtSuK9kfa/s+a4f4i5pLkw=="
        crossorigin="anonymous" />

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css"
        integrity="sha512-HK5fgLBL+xu6dm/Ii3z4xhlSUyZgTT9tuc/hSrtw6uzJOvgRr2a9jyxxT1ely+B+xFAmJKVSTbpM/CuL7qxO8w=="
        crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.css"
        integrity="sha512-1cK78a1o+ht2JcaW6g8OXYwqpev9+6GqOkz9xmBN9iUUhIndKtxwILGWYOSibOKjLsEdjyjZvYDq/cZwNeak0w=="
        crossorigin="anonymous" />
    <link rel="stylesheet" href="assets/css/custom.css">
    <title>Document</title>
</head>

<body>
    <div class="video-popup full-bg">
        <span class="fa fa-times close"></span>
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-md-10">
                    <div class="video-container">
                        <div class="rute-menu">
                            <span class="fa fa-route toggle-route"></span>
                            <ul class="rute-list">
                            </ul>
                        </div>
                        <div class="preview-img">
                            <a href="" target="_blank" class="to-destination">
                                <img src="" class="img-fluid" alt="">
                            </a>
                            <a href="" target="_blank" data-destination=""
                                class="download-kmz btn btn-green btn-sm mt-1"><span class="fa fa-download"></span>
                                Download
                                Rute</a>
                        </div>
                        <video style="width:100%" controls autoplay>
                        </video>
                        <span class="fa fa-play-circle icon-play-video" style="visibility: hidden;"></span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <nav class="navbar navbar-expand-lg navbar-light nav-top fixed-top">
        <div class="container custom">
            <a class="navbar-brand" href="#">
                <img src="assets/img/common/logo.png" width="150" alt="" srcset="">
            </a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
                aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav ml-auto">
                    <li class="nav-item active">
                        <a class="nav-link" href="index.html"> <i class="fa fa-home"></i> <span
                                class="sr-only">(current)</span></a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="about.html">About Us</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="search.html">Sites</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="routes.html">Routes</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    <section class="full-bg py-5" id="routes">
        <div class="container custom mt-5">
            <div class="row justify-content-center">
                <div class="col-md-11">
                    <div class="owl-routes owl-carousel">
                    </div>
                    <a href="search.html" class="float-right mr-1 mt-3 btn btn-green py-3 px-5 font-weight-bold">NEXT /
                        SKIP</a>
                </div>
            </div>
        </div>
    </section>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"
        integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg=="
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/owl.carousel.min.js"
        integrity="sha512-bPs7Ae6pVvhOSiIcyUClR7/q2OAsRiovw4vAkX+zJbw3ShAeeqezq50RIIcIURq7Oa20rW2n2q+fyXBNcU9lrw=="
        crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"
        integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.js"
        integrity="sha512-A7AYk1fGKX6S2SsHywmPkrnzTZHrgiVT7GcQkLGDe2ev0aWb8zejytzS8wjo7PGEXKqJOrjQ4oORtnimIRZBtw=="
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vanilla-tilt/1.7.0/vanilla-tilt.min.js"
        integrity="sha512-SttpKhJqONuBVxbRcuH0wezjuX+BoFoli0yPsnrAADcHsQMW8rkR84ItFHGIkPvhnlRnE2FaifDOUw+EltbuHg=="
        crossorigin="anonymous"></script>

    <script src="assets/js/custom.js"></script>
    <script src="assets/js/destinations.js"></script>

    <script>
        $.each(routes, function (i, data) {
            $(".owl-routes").append(`<div class="item mx-2" data-index="${i}">
                            <h3>${data.name}</h3>
                            <div class="layer">
                                <video src="assets/video/${data.video}" width="100%">
                                </video>
                                <div class="icon-play">
                                    <span class="fa fa-play"></span>
                                </div>
                            </div>
                        </div>`)

        })
        $(".owl-routes").owlCarousel({
            items: 2,
        });
        $(".toggle-route").click(function () {
            $(".rute-menu").toggleClass('show')
        })
        var plainVideo = $(".video-popup video").get(0);
        var playBtn = ".video-container .icon-play-video";
        var videoActive;
        $(".icon-play").click(function () {
            videoActive = $(this).closest('.item').data('index')
            $(".video-popup").addClass("active")
            var src = $(this).closest('.layer').find('video').attr('src')
            $(".video-popup video").attr("src", src)
            $.each(routes[videoActive].route, function (i, data) {
                var destinationName = destinations[data.destination].name
                $(".rute-list").append(`<li><a href="#" data-jump="${data.start}">${destinationName}</a></li>`)
            })
            $(".rute-list a").click(function (e) {
                e.preventDefault()
                var jump = $(this).attr("data-jump")
                plainVideo.currentTime = jump
                plainVideo.play()
                $(playBtn).css("visibility", "hidden");
            })
        })


        $(".video-popup .close").click(function () {
            $(".video-popup").removeClass("active")
            $(playBtn).css("visibility", "hidden");
            plainVideo.pause()
            $(".rute-list li").remove()
            $(".rute-menu").removeClass('open')
            $(".rute-menu").removeClass('show')
        })

        $(playBtn).click(function () {
            $(this).css("visibility", "hidden")
            $(".preview-img img").attr('src', '')
            $(".preview-img").removeClass('show')
            plainVideo.play()
            $(".rute-menu").removeClass('open')
            $(".rute-menu").removeClass('show')
        })
        plainVideo.addEventListener("click", function () {
            if ($(playBtn).css("visibility") == "visible") {
                $(".preview-img img").attr('src', '')
                $(".preview-img").removeClass('show')
                // plainVideo.play();
                $(playBtn).css("visibility", "hidden");
                $(".rute-menu").removeClass('open')
                $(".rute-menu").removeClass('show')
            }
            else {
                // plainVideo.pause();
                $(playBtn).css("visibility", "visible");
                $(".rute-menu").addClass('open')
            }
        })
        var time = 0
        var getIndex = -1
        plainVideo.addEventListener("timeupdate", function () {
            var currentTime = parseInt(this.currentTime);
            if (currentTime != time) {
                $.each(routes[videoActive].route, function (i, data) {
                    if (currentTime >= data.start && currentTime <= data.end) {
                        getIndex = i
                        $(".rute-list a").removeClass('active')
                        $(".rute-list a[data-jump='" + data.start + "']").addClass('active')
                        return false
                    }
                    else {
                        getIndex = -1
                    }
                })
                if (getIndex != -1) {
                    $(".preview-img img").attr('src', 'assets/img/info-rute/' + destinations[routes[videoActive].route[getIndex].destination].pinImg)
                    $(".preview-img").addClass('show')
                    var link = routes[videoActive].route[getIndex].destination + 1
                    $(".preview-img .to-destination").attr('href', 'details.html?destination=' + link)
                    $(".preview-img .download-kmz").attr('data-destination', routes[videoActive].route[getIndex].destination)
                }
                else {
                    $(".preview-img").removeClass('show')
                }
            }
            time = parseInt(this.currentTime)
        });

        $(".preview-img .download-kmz").click(function (e) {
            e.preventDefault()
            var download = []
            $.each(destinations[routes[videoActive].route[getIndex].destination].rute, function (i, data) {
                download[i] = [data, "assets/rute/" + data]
            })
            downloadAll(download);
        })


        AOS.init()
    </script>
</body>

</html>